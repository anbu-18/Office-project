import sqlite3
from flask import jsonify
import json
class malwaredetect():
    def __init__(self):
        self.conn =  sqlite3.connect('test.db')
        self.c = self.conn.cursor()

    def table_creation(self):
        self.c.execute(' CREATE TABLE IF NOT EXISTS urlcollection(urls TEXT)')

    def table_values(self,urldata):
        url = urldata['url']
        self.c.execute("INSERT INTO urlcollection VALUES ('"+url+"')")
        self.conn.commit()
        self.c.close()
        self.conn.close()
        return "inserted successfully"

    def getallvalues(self):
        self.c.execute("SELECT * from urlcollection")
        val = self.c.fetchall()
        jsss = json.dumps(val)
        self.c.close()
        self.conn.close()
        return jsss

    def detection(self,urldata):
        url = urldata['url']
        self.c.execute("SELECT COUNT(*) from urlcollection where urls = '"+url+"'")
        count = self.c.fetchone()
        if count[0] == 0:
            response = jsonify({"status":"Allow"})
            return response
        else:
            response = jsonify({"status":"Blocked"})
            return response
        
        
